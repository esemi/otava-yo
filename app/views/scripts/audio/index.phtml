<?php

$authFlag = Zend_Controller_Action_HelperBroker::getStaticHelper('CheckAccess')->moderAccess();

?>

<section class="field-bg">
	<h2 class="title-page-name text-center"><?= $this->translate('title.audio.index'); ?></h2>

	<? if( $authFlag ): ?>
		<a class="news-button" href="<?= $this->url(array(), 'staticAlbumCreate') ?>"><?= $this->translate('button.album.add'); ?></a>
	<? endif; ?>

	<? foreach($this->albums as $album): ?>
		<article>
			<hgroup>
				<h3 class="title-album"><?= $this->escape($album['title']); ?></h3>
				<time class="album-year" datetime="<?= $this->escape($album['year']); ?>"><?= $this->escape($album['year']); ?></time>
			</hgroup>
			<div class="album-cover">
				<img alt="обложка альбома «<?= $this->escape($album['title']); ?>»" src="<?= $album['img_link']; ?>">
			</div>
			<ul class="audio-list">
				<? foreach($this->audio as $audio): ?>
					<? if( $album['id'] == $audio['album_id'] ): ?>
						<li class="js-track" track-id="<?= $this->escape($audio['id']) ?>" media-link="<?= $this->escape($audio['audio_link']) ?>">
							<div class="js-audio-item-play play"></div>
							<div class="js-audio-item-stop stop hide"></div>
							<?= $this->escape($audio['title']) ?>
						</li>
					<? endif; ?>
				<? endforeach; ?>
			</ul>
			<? if( !empty($album['desc']) ): ?>
				<div class="album-desc"><?= $album['desc']; ?></div>
			<? endif; ?>

			<? if( $authFlag ): ?>
				<footer>
					<a class="edit" title="редактировать" href="<?= $this->url(array('idAl' => $album['id'] ), 'staticAlbumEdit') ?>"><?= $this->translate('button.edit'); ?></a>
					<a class="edit" title="редактировать плейлист" href="<?= $this->url(array('idAl' => $album['id'] ), 'staticPlaylistEdit') ?>"><?= $this->translate('button.edit-playlist'); ?></a>
					<a class="delete" title="удалить" href="<?= $this->url(array('idAl' => $album['id'] ), 'staticAlbumDelete') ?>"><?= $this->translate('button.delete'); ?></a>
				</footer>
			<? endif; ?>
		</article>
		<hr>
	<? endforeach; ?>


	<div class="player">
		<div id="jquery_jplayer_audio" class="jp-jplayer"></div>
		<div id="jp_container_1" class="jp-audio">
			<div class="jp-type-single">
				<div class="jp-gui jp-interface">
				<ul class="jp-controls">
					<li><a href="javascript:;" class="jp-play" tabindex="1">play</a></li>
					<li><a href="javascript:;" class="jp-pause" tabindex="1">pause</a></li>
					<li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>
					<li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>
					<li><a href="javascript:;" class="jp-unmute" tabindex="1" title="unmute">unmute</a></li>
					<li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>
				</ul>
				<div class="jp-progress">
					<div class="jp-seek-bar">
						<div class="jp-play-bar"></div>
					</div>
				</div>
				<div class="jp-volume-bar">
					<div class="jp-volume-bar-value"></div>
				</div>
					<div class="jp-time-holder">
						<div class="jp-current-time"></div>
						<div class="jp-duration"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
