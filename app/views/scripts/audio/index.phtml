<?php

$version = $this->cacheVersion();

$this->headLink()->appendStylesheet("/css/jquery-ui-1.10.3.custom.min.css?{$version}");
$this->headScript()->appendFile( "/js/jquery-ui-1.10.3.custom.min.js");

$authFlag = Zend_Controller_Action_HelperBroker::getStaticHelper('CheckAccess')->moderAccess();

?>

<section class="field-bg">
	<h2 class="title-page-name text-center"><?= $this->translate('title.audio.index'); ?></h2>

	<p class="error-fixed js-ajax-error">
		<? if( !empty($this->error) ): ?>
			<?= $this->escape($this->error); ?>
		<? endif; ?>
	</p>

	<? if( $authFlag ): ?>
		<a class="news-button" href="<?= $this->url(array(), 'staticAlbumCreate') ?>"><?= $this->translate('button.album.add'); ?></a>
	<? endif; ?>

	<? foreach($this->albums as $album): ?>
		<article>
			<hgroup>
				<h3 class="title-album"><?= $this->escape($album['title']); ?></h3>
				<time class="album-year" datetime="<?= $this->escape($album['year']); ?>"><?= $this->escape($album['year']); ?></time>
			</hgroup>
			<div class="album-cover">
				<img alt="обложка альбома «<?= $this->escape($album['title']); ?>»" src="<?= $album['img_link']; ?>">
			</div>
			<? if( $authFlag ): ?>
				<ul class="js-playlist-editable"
					data-album-id="<?= $this->escape($album['id']); ?>"
					data-remove-url="<?= $this->url(array(), 'audioRemoveTrack'); ?>"
					data-sort-url="<?= $this->url(array(), 'audioSortPlaylist'); ?>"
					data-add-url="<?= $this->url(array(), 'audioAddTrack'); ?>">
			<? else: ?>
				<ul class="audio-list">
			<? endif; ?>
			<? foreach($this->audio as $audio): ?>
				<?
					if( $album['id'] == $audio['album_id'] ){
						echo $this->partial('Partials/audio-item.phtml', array(
							'audio' => $audio,
							'authFlag' => $authFlag));
					}
				?>
			<? endforeach; ?>
			</ul>

			<? if( $authFlag ): ?>
				<div class="adding-new-track">
					<label for="track-name"><?= $this->translate('label.new.track'); ?>:</label>
					<div class="hide js-playlist-item-template">
						<?= $this->partial('Partials/audio-item.phtml', array(
							'audio' => array('audio_link' => null, 'id' => '%id%', 'title' => ''),
							'authFlag' => $authFlag)); ?>
					</div>
					<input type="text" id="track-name" value="" placeholder="Введите название трека" class="js-playlist-add-title input-song-name">
					<span class="js-playlist-add-button" data-mode="add"><?= $this->translate('button.add.lowercase'); ?></span>
				</div>
			<? endif; ?>

			<? if( !empty($album['desc']) ): ?>
				<div class="album-desc"><?= $album['desc']; ?></div>
			<? endif; ?>

			<? if( $authFlag ): ?>
				<footer>
					<a class="edit" title="редактировать" href="<?= $this->url(array('idAl' => $album['id'] ), 'staticAlbumEdit') ?>"><?= $this->translate('button.edit'); ?></a>
					<a class="delete" title="удалить" href="<?= $this->url(array('idAl' => $album['id'] ), 'staticAlbumDelete') ?>"><?= $this->translate('button.delete'); ?></a>
				</footer>
			<? endif; ?>
		</article>
		<hr>
	<? endforeach; ?>


	<div class="player">
		<div id="jquery_jplayer_audio" class="jp-jplayer"></div>
		<div id="jp_container_1" class="jp-audio">
			<div class="jp-type-single">
				<div class="jp-gui jp-interface">
				<ul class="jp-controls">
					<li><a href="javascript:;" class="jp-play" tabindex="1">play</a></li>
					<li><a href="javascript:;" class="jp-pause" tabindex="1">pause</a></li>
					<li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>
					<li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>
					<li><a href="javascript:;" class="jp-unmute" tabindex="1" title="unmute">unmute</a></li>
					<li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>
				</ul>
				<div class="jp-progress">
					<div class="jp-seek-bar">
						<div class="jp-play-bar"></div>
					</div>
				</div>
				<div class="jp-volume-bar">
					<div class="jp-volume-bar-value"></div>
				</div>
					<div class="jp-time-holder">
						<div class="jp-current-time"></div>
						<div class="jp-duration"></div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<input type="hidden" name="csrf" value="<?= $this->csrfToken(); ?>">
</section>
