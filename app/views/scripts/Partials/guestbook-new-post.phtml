<?php
$authFlag = Zend_Controller_Action_HelperBroker::getStaticHelper('CheckAccess')->moderAccess();
$moderAuthor = Zend_Controller_Front::getInstance()->getParam('bootstrap')->getOption('guestbook_reserved_name');

if( !empty($this->postData['author']) ){
	$authorField = $this->postData['author'];
}elseif( $authFlag === true ){
	$authorField = $moderAuthor;
}else{
	$authorField = '';
}

?>

<? if( !empty($this->error) ): ?>
	<p class="error"><?= $this->error ?></p>
<? endif; ?>
<form name="post" method="POST">
	<table>
		<tbody>
			<tr>
				<td>
					<label for="author">Имя: </label>
				</td>
				<td>
					<input type="text" id="author" name="author" value="<?= $this->escape($authorField); ?>" placeholder="имя*" maxlength="100"/><br>
				</td>
			</tr>
			<tr>
				<td>
					<label for="email">email: </label>
				</td>
				<td>
					<input type="email" id="email" name="email" value="<?= (isset($this->postData['email'])) ? $this->escape($this->postData['email']) : ''; ?>" placeholder="email" maxlength="150"/><br>
				</td>
			</tr>
			<tr>
				<td>
					<label for="site">сайт: </label>
				</td>
				<td>
					<input type="url" id="site" name="site" value="<?= (isset($this->postData['site'])) ? $this->escape($this->postData['site']) : ''; ?>" placeholder="сайт" maxlength="255"/><br>
				</td>
			</tr>
			<tr>
				<td>
					<label for="city">город/страна: </label>
				</td>
				<td>
					<input type="text" id="city" name="city" value="<?= (isset($this->postData['city'])) ? $this->escape($this->postData['city']) : ''; ?>" placeholder="город/страна" maxlength="255"/><br>
				</td>
			</tr>
		</tbody>
	</table>
	<label>Сообщение: </label>
	<textarea name="content" class="message" placeholder="сообщение*" maxlength="10000"><?= (isset($this->postData['content'])) ? $this->escape($this->postData['content']) : ''; ?></textarea><br>

	<? if( !is_null($this->recaptcha) && $authFlag === false ): ?>
		<div class="guest-recaptcha">
			<?= $this->recaptcha->getHTML(); ?>
		</div>
	<? endif; ?>

	<input type="hidden" name="csrf" value="<?= $this->csrfToken(); ?>">
	<input class="submit" type="submit" name="отправить" value="отправить">
</form>