<?php

$authFlag = Zend_Controller_Action_HelperBroker::getStaticHelper('CheckAccess')->moderAccess();

?>


<section class="field-bg">
	<h2 class="title-page-name text-center"><?= $this->translate('title.news.index'); ?></h2>

	<? if( $authFlag ): ?>
		<a class="news-button" href="<?= $this->url(array(), 'staticNewsCreate') ?>">написать</a>
	<? endif; ?>

	<?
	$currentYear = date('Y');
	foreach( $this->news as $item ):
		$itemYear = DateTime::createFromFormat('Y-m-d', $item->date_publish)->format('Y');
		if( $itemYear != $currentYear )
		{
			printf('<h3 class="old-concert-headding text-center">%s</h3>', $this->escape($itemYear));
			$currentYear = $itemYear;
		}
	?>
		<article class="news-block">
			<header>
				<time class="date-news" datetime="<?= $this->escape($item->date_publish); ?>">
					<?= $this->prepareConcertDate($item->date_publish); ?>
				</time>
				<h3 class="title">
					<a name="<?= sprintf("view%d", $item->id); ?>" href="<?= $this->url(array('id' => $item->id ), 'staticNewsView') ?>">
						<?= $this->escape($item->title); ?>
					</a>
				</h3>
			</header>

			<?= $item->content; ?>

			<footer>
				<? if( $authFlag ): ?>
					<a class="edit" title="редактировать" href="<?= $this->url(array('idN' => $item->id ), 'staticNewsEdit') ?>"></a>
					<a class="delete" title="удалить" href="<?= $this->url(array('idN' => $item->id ), 'staticNewsDelete') ?>"></a>
				<? endif; ?>
				<p class="signature"><?= $this->escape($this->moder_author); ?></p>
			</footer>
		</article>
		<hr>
	<? endforeach; ?>
</section>