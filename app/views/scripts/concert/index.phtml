<?php

$authFlag = Zend_Controller_Action_HelperBroker::getStaticHelper('CheckAccess')->moderAccess();

?>

<section class="field-bg">

	<? if( $authFlag ): ?>
		<a class="news-button" href="<?= $this->url(array(), 'staticConcertCreate') ?>">добавить</a>
	<? endif; ?>

	<? if( $this->concerts->count() > 0 ): ?>
	<section>
		<h2 class="title-page-name text-center">ближайшие концерты</h2>
		<? foreach( $this->concerts as $item ): ?>
			<article class="concert-block">
				<? if( $authFlag ): ?>
					<aside>
						<a href="<?= $this->url(array('idC' => $item->id ), 'staticConcertEdit') ?>">Редактировать
							<div class="edit"></div>
						</a>
						<a class="delete" href="<?= $this->url(array('idC' => $item->id ), 'staticConcertDelete') ?>">удалить концерт
							<div class=""></div>
						</a>
					</aside>
				<? endif; ?>
				<header>
					<time class="date-concert" datetime="<?= $this->prepareConcertDatetime($item->date, $item->time); ?>">
						<?= $this->prepareConcertDate($item->date); ?>
						<div class="time">
							<?= ( !empty($item->time) ) ? $this->escape($item->time) : ''; ?>
						</div>
					</time>

					<hgroup>
						<h3 class="concert-name">
							<a class="title" name="<?= sprintf("view%d", $item->id); ?>" href="<?= $this->url(array('id' => $item->id ), 'staticConcertView') ?>">
								<?= $this->escape($item->title); ?>
							</a>
						</h3>

						<? if( !empty($item->place) ): ?>
							<h4 class="concert-place"><?= $this->escape($item->place); ?></h4>
						<? endif; ?>
					</hgroup>
				</header>

				<p>
					<?= $this->escape($item->desc); ?>
				</p>
				<? if( !empty($item->link) ): ?>
					<p class="concert-link">
						<a rel="nofollow" target="_blank" href="<?= $item->link ?>" rel="nofollow"><?= $this->escape($item->link); ?></a>
					</p>
				<? endif; ?>

				<? if( !empty($item->cost) ): ?>
					<p class="concert-ticets"><span class="ticets">Билеты:</span> <?= $this->escape($item->cost); ?></p>
				<? endif; ?>
			</article>
			<hr>
		<? endforeach; ?>
	</section>
	<? endif; ?>

	<section>
		<h2 class="old-concert-headding text-center">прошедшие концерты</h2>
		<?php
		$currentYear = date('Y');
		foreach( $this->oldConcerts as $item ):
			$itemYear = DateTime::createFromFormat('Y-m-d', $item->date)->format('Y');
			if( $itemYear != $currentYear )
			{
				printf('<h3 class="old-concert-headding text-center">%s</h3>', $this->escape($itemYear));
				$currentYear = $itemYear;
			}
		?>
			<article class="concert-block">
				<header>
					<time class="date-concert-old" datetime="<?= $this->prepareConcertDatetime($item->date, $item->time); ?>">
						<?= $this->prepareConcertDate($item->date); ?>
						<div class="time">
							<?= ( !empty($item->time) ) ? $this->escape($item->time) : ''; ?>
						</div>
					</time>

					<hgroup>
						<h3 class="concert-name">
							<a class="title" name="<?= sprintf("view%d", $item->id); ?>" href="<?= $this->url(array('id' => $item->id ), 'staticConcertView') ?>">
								<?= $this->escape($item->title); ?>
							</a>
						</h3>

						<? if( !empty($item->place) ): ?>
							<h4 class="concert-place"><?= $this->escape($item->place); ?></h4>
						<? endif; ?>
					</hgroup>
				</header>
				<p><?= $this->escape($item->desc); ?></p>
				<? if( !empty($item->link) ): ?>
					<p class="concert-link">
						<a rel="nofollow" target="_blank" href="<?= $item->link ?>" rel="nofollow"><?= $this->escape($item->link); ?></a>
					</p>
				<? endif; ?>
				<? if( !empty($item->cost) ): ?>
					<p class="concert-ticets"><span class="ticets">Билеты:</span> <?= $this->escape($item->cost); ?></p>
				<? endif; ?>
			</article>
			<hr>
		<? endforeach; ?>
	</section>
</section>