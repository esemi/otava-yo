<?php

$authFlag = Zend_Controller_Action_HelperBroker::getStaticHelper('CheckAccess')->moderAccess();

?>

<section class="field-bg">
	<h2 class="title-page-name text-center"><?= $this->translate('title.guestbook.index'); ?></h2>
	<div class="js-guestbook-add-button guest-button  <?= ( $this->showForm ) ? 'hide' : ''; ?>">
		<?= $this->translate('guestbook.button.write'); ?>
	</div>
	<section class="js-guestbook-add-form <?= ( !$this->showForm ) ? 'hide' : ''; ?>">
		<?= $this->partial('Partials/guestbook-new-post.phtml', array(
			'postData' => $this->postData,
			'error' => $this->errorMessage,
			'recaptcha' => $this->recaptcha)); ?>
	</section>
	<div class="bg-fix-ie7"></div>
	<hr>

	<? foreach( $this->notes as $item ): ?>
		<article class="guest-post">
			<header>
				<span class="name title-em"><?= $this->escape($item->author); ?></span>
				<? if( !empty($item->city) ): ?>
					<span class="city">(<?= $this->escape($item->city); ?>)</span>
				<? endif; ?>
				<? if( !empty($item->email) ): ?>
					<a title="почта" class="email" href="mailto:<?= $this->escape($item->email); ?>" target="_blank" rel="nofollow">почта</a>
				<? endif; ?>
				<? if( !empty($item->site) ): ?>
					<a title="сайт" class="site" href="<?= $this->escape($item->site); ?>" target="_blank" rel="nofollow">сайт</a>
				<? endif; ?>
				<time datetime="<?= $this->escape($item->iso_date); ?>"><?= $this->escape($item->user_date); ?></time>
			</header>
			<p>
				<?= str_replace("\n", '<br>', $this->escape($item->content)); ?>
			</p>

			<? if( $authFlag ): ?>
				<footer>
					<a class="edit" title="редактировать" href="<?= $this->url(array('idP' => $item->id ), 'staticGuestbookEdit') ?>"><?= $this->translate('button.edit'); ?></a>
					<a class="delete" title="удалить" href="<?= $this->url(array('idP' => $item->id ), 'staticGuestbookDelete') ?>"><?= $this->translate('button.delete'); ?></a>
				</footer>
			<? endif; ?>
		</article>
		<hr>
	<? endforeach; ?>

</section>